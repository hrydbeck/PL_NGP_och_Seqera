---
title: "PL, NGP och Nextflow"
# author: "Halfdan Rydbeck"
date: now
format: 
  revealjs:
   theme: league
   chalkboard: true
   preview-links: auto
   logo: images\RÖ_logos\ROlogo-P-vit.png
   css: logo.css
   # multiplex: true
   
   
editor: visual
---

## [Precisionsmedicinskt Laboratorium (PL) - service]{style="color:orange;"}

::: columns
::: {.column width="70%"}
![](images\pl_summary\pl_3_2.png){width="400"}
:::

::: {.column width="30%"}
-   [**Biologiskt prov**]{style="color:blue;"}
:::

:::

## [Precisionsmedicinskt Laboratorium (PL) - service]{style="color:orange;"}

::: columns
::: {.column width="70%"}
![](images\pl_summary\pl_3_3.png){width="400"}
:::

::: {.column width="30%"}

-   [**Biologiskt prov**]{style="color:blue;"}

-   [**Variant(er)**]{style="color:green;"}


:::
:::

## [Precisionsmedicinskt Laboratorium (PL) - service]{style="color:orange;"}


::: columns
::: {.column width="70%"}

![](images\pl_summary\pl_3_4.png){width="400"}

:::

::: {.column width="30%"}

-   [**Biologiskt prov**]{style="color:blue;"}

-   [**Variant(er)**]{style="color:green;"}

-   [**Resistensgener**]{style="color:orange;"}


:::
:::

## PL- Next Genaration Sequencing (NGS) {auto-animate="true"}

![](images\pl_arbetsflöde\pl_4_2.png){.lightbox width="400"}

## PL - NGS - Arbetsflöden

::: columns
::: {.column width="50%"}
![](images\pl_arbetsflöde\pl_4_3.png)
:::

::: {.column width="50%"}
-   Lab
    -   [Biblioteks preparation]{style="color:blue;"}
-   Bioinformatik och tolkning
    -   [Patologi och sällsynta diagnoser]{style="color:green;"}
    -   [Mikrobiologi]{style="color:yellow;"}
:::
:::

## PL - gemensamt

![](images\pl_gemensamt\pl_gemensamt_2.png)

## PL - gemensamt

![](images\pl_gemensamt\pl_gemensamt_3.png)

## Sekvensering, nätverk, lagring och beräkningsresurser


![](images\networks2\networks2.drawio.png)

## Sekvensering, nätverk, lagring och beräkningsresurser


![](images\networks2\networks4.drawio.png)

## 


![](images\networks2\networks7.drawio.png)

## 


![](images\networks2\networks8.drawio.png)

## 


![](images\networks2\networks10.drawio.png)

<!--

![](images\networks.drawio_no_legend_2.png)



![](images\networks\snabbt_nätverk.drawio_no_legend.png)
-->
## Beräkings resurser - High Performance computing Cluster (HPC)

![](images\HPC-schematic.png)

## Beräkings resurser - Moln beräkning (AWS)

![](images\Cloud_computing.png)

## PL ingår i nätverket Genome Medicine sweden (GMS)

Parallelt med Scilife-lab nätverk

::: columns
::: {.column width="40%"}
![](images\pl_GMC_1.png)
:::

::: {.column width="60%"}
-   Clinical Genomic (CG) key services
-   Genomisk Medicin Centrum (GMC)
:::
:::



## National genomics Platform (NGP)

Navet i GMS inbördes samverkan

![](images\pl_NGP_1.png)

## NGP - mer detaljerat

Också samverkan med andra instanser

![](images\NGPÖversikt_1.png)

## Vision - NGP ingår i ett Europeiskt datadelningsnätverk

![](images\pl_ngp_ehds_1.png)

## NGP kör i huvudsak workflows

-   På NGP commander (NGPc) installeras det workflows. Huvudsakligen baserat på Workflow management systemet Nextflow.
-   Vad är ett workflow?

## Mina uppgifter

- Lasta upp sekvensdata från hårdiskar och klinisk data från LIS till NGP
  - Det som finns lagrat
  - Automatik för framtiden
- Få rardisease pipelinen att köra 
  - Med test-data på Dardell
  - Med vår data på NGP/GRID
- Hjälpa till som bioinformatiker
  - Mikrobilellt övervaknings verktyg på NGP

## Sällsynta diagnoser - workflow

::: columns
::: {.column width="80%"}
![](images\Workflow.drawio_1_a.png)
:::

::: {.column width="20%"}
![](images\pl_arbetsflöde\pl_4_3_rd.png)
:::
:::

## Sällsynta diagnoser - workflow - hur det skulle kunna se ut




::: columns
::: {.column width="80%"}
![](images\raredisease_metromap_dark.png)

:::

::: {.column width="20%"}
![](images\pl_arbetsflöde\pl_4_3_rd.png)

:::
:::



## Hur var kan ett sådant/sådana arbetsflöde(n) utvecklas och köras?

- Samarbetsbaserad och versionskontrollerad utveckling
- Friktionslöst att köra på olika system
- Skalerbart - HPC, moln
- Hjälpsystem för hanteringen av komplexiteten hos ett arbetsflöde

## Workflow managment systems, Seqera, Nexflow summarized

![](images\nextflow_summary\nextflow_summary_0.png)


## Workflow managment systems, Seqera, Nexflow summarized

![](images\nextflow_summary\nextflow_summary_1.png)

## Vad kan versionskontrolleras?

::: columns
::: {.column width="50%"}
![](images\text_file_verson_controlling.png)
:::

::: {.column  width="50%"}
![](images\folder_verson_controlling.png)
:::
:::

## Git ett system för versionskontrollering


![](images\git_1.png)

## Kollektivt versionskontrollerad mjukvaruutveckling A


![](images\github_1.png)

## Några Github förvaringsplatser/repositories...

- [För den här presentationen](https://github.com/hrydbeck/PL_NGP_och_Seqera)
- [För bwa-mem2](https://github.com/bwa-mem2/bwa-mem2)
- [Illumina Manta](https://github.com/Illumina/manta)

## Köra var som helst

Mjukvara förpackas med nödvändiga komponenter (dependancies) från OS och programmeringsmiljö i "containers"

::: columns
::: {.column width="30%"}
![](images\containers_1.png)
:::

::: {.column width="30%"}


Från programspråk (Package managers):

  -   Conda
  -   PyPI

:::

::: {.column width="30%"}

Från OS (Container engines):

  -   Docker
  -   Singularity
  -   Wave

:::

:::

## Workflow managment systems, Seqera, Nexflow summarized

![](images\nextflow_summary\nextflow_summary_2.png)

## Make and run singularity container on virtual server

Gå till [Seqera containers](https://seqera.io/containers/) och få en container för ett program.Tex bwa-mem2.

community.wave.seqera.io/library/bwa-mem2:b477244b26cdcee4

```
wave --conda bwa 
```

## HPC - cloud - Jobbschemaläggare och resurshanterare


::: columns
::: {.column width="50%"}
![](images\pl_NGP_2.png)
:::

::: {.column width="50%"}
-   Slurm
-   Altair grid engine
-   Kubernetes
-   ...

:::
:::


## Workflow managment systems, Seqera, Nexflow summarized

![](images\nextflow_summary\nextflow_summary_3.png)

## Nextflow är ett programmeringsspråk



## Arbetssflödes hanteringsprogram

Nextflow

![](images\nextflow_1.PNG){width="700"}

## nf-core modules

[nf-core modules](https://nf-co.re/modules/){preview-link="true"}

## Nextflow, nf-core pipelines are stored on Github

[Nextflow, nf-core pipelines are stored on Github](https://github.com/nf-core)

## Workflow managment systems, Seqera, Nexflow summarized

![](images\nextflow_summary\nextflow_summary_4.png)

## Workflow managment systems, Seqera, Nexflow summarized

![](images\nextflow_summary\nextflow_summary_5.png)

## Nextflow from command line


## Seqera platform

Also put in an image of file tree to show that getting an overview of all the files is messy from command line

![](images\seqera_1.png){width="700"}










## Excalidraw

[Excalidraw](https://excalidraw.com/){preview-link="true"}

## Code

When you click the **Render** button a presentation will be generated that includes both content and the output of embedded code. You can embed code like this:

```{r}
1 + 1
```
